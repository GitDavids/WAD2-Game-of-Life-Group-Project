{% extends 'game_of_life/base.html' %}
{% load staticfiles %}

{% block head_block %}
<link rel="stylesheet" href="{% static 'css/base.css' %}">
<link rel="stylesheet" href="{% static 'css/profile.css' %}">

{% endblock %}

{% block title_block %}
    Profile
{% endblock %}

{% block body_block %}

    <div class="profile">
        <div>
            {% if user.username == request.user.username %}
                <h3 class="profile_heading">My Profile</h3>
            {% else %}
                <h3 class="profile_heading">{{user.username}}'s Profile</h3>
            {% endif %}

            <!-- PROFILE PIC -->
            <p style="float: left;">
                <script>console.log("{{user.profile_picture}}")</script>
                {% if user.profile_picture %}
                    <img class="profile_picture" src="{{MEDIA_URL}}profile_images/{{user.profile_picture}}">
                {% else %}
                    <img class="profile_picture" src="{{MEDIA_URL}}profile_images/default.jpg">
                {% endif %}
            </p>

            <!-- FRIENDS -->
            <p>
                {% if user.username == request.user.username %}
                    <h3 class="profile_heading">My Profile Page</h3>
                    <h4> My friends:</h4>
                    {% for friend in friends %}
                        <a href="{% url 'game_of_life:profile' friend %}">{{friend}}</a>
                    {% endfor %}

                {% else %}
                    <h3 class="profile_heading">{{user.username}}'s Profile Page</h3>
                    <h4> Their friends:</h4>
                    {% for friend in friends %}
                    {{friend}}
                    {% endfor %}
                    <p>
                    {% if request.user.is_authenticated and user.username not in requester_friends%}
                        <form action="{% url 'game_of_life:add_friend' user.username %}">
                            <input type="submit" value="Let's be friends!"/>
                        </form>
                    {% elif request.user.is_authenticated %}
                            <input type="submit" value="Already your friend" />
                    {% endif %}
                    </p>
                {% endif %}
                <p>

                    {% for friend in user.friends %}
                        friend
                    {% endfor %}
                </p>
            </p>
        </div>


        <div id="states" style="clear: both;">

        <H1>User states</H1>
        {% if states %}
            <script>state_list = []</script>
            <div class="state_grid">
            {% for state in states %}
            <div class="state_wrap">
                <a id="{{state.name}}" href="{% url 'game_of_life:initial_state' user.username state.slug %}"><canvas class="state"></canvas></a>
                <a class="state_description" href="{% url 'game_of_life:initial_state' user.username state.slug %}">
                    State name: {{state.name}},<br/>
                    Author:  {{state.author.username}},<br />
                    Views: {{state.views}},
                    Likes: {{state.likes}}, <br />
                    Date created: {{state.date_created}},
                </a>
                <script>state_list.push(JSON.parse('{{state.state}}'))</script>
            </div>
                {% endfor %}
                </div>
        {% else %}
            User has not made any states
        {% endif %}
    </div>

    <script src="{% static 'js/initial_state_thumbnails.js' %}"></script>
    <script>document.getElementById("profile").className = "active";
    </script>

    </div>

{% endblock %}